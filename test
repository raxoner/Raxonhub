-- Pastikan script dijalankan di LocalScript
local player = game.Players.LocalPlayer
local playerGui = player:FindFirstChild("PlayerGui")

if not playerGui then
    warn("Tidak ditemukan PlayerGui!")
    return
end

-- Nama file untuk menyimpan password
local passwordFile = "SuperCapy/password.txt"
makefolder("SuperCapy") -- Membuat folder jika belum ada
local defaultPassword = "WargaCapy456"

-- Cek apakah password sudah tersimpan
local savedPassword
if isfile(passwordFile) then
    savedPassword = readfile(passwordFile)
else
    writefile(passwordFile, defaultPassword)
    savedPassword = defaultPassword
end

-- UI Login
local LoginGUI = Instance.new("ScreenGui")
LoginGUI.Name = "SuperCapyLogin"
LoginGUI.Parent = playerGui

local LoginFrame = Instance.new("Frame")
LoginFrame.Size = UDim2.new(0, 300, 0, 150)
LoginFrame.Position = UDim2.new(0.5, -150, 0.5, -75)
LoginFrame.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
LoginFrame.Parent = LoginGUI

local Title = Instance.new("TextLabel")
Title.Size = UDim2.new(1, 0, 0, 30)
Title.Text = "SuperCapy Login"
Title.TextSize = 18
Title.TextColor3 = Color3.fromRGB(255, 255, 255)
Title.BackgroundTransparency = 1
Title.Parent = LoginFrame

local PasswordBox = Instance.new("TextBox")
PasswordBox.Size = UDim2.new(0.8, 0, 0, 30)
PasswordBox.Position = UDim2.new(0.1, 0, 0.4, 0)
PasswordBox.PlaceholderText = "Masukkan Password"
PasswordBox.Text = ""
PasswordBox.Parent = LoginFrame

local LoginButton = Instance.new("TextButton")
LoginButton.Size = UDim2.new(0.8, 0, 0, 30)
LoginButton.Position = UDim2.new(0.1, 0, 0.7, 0)
LoginButton.Text = "Login"
LoginButton.BackgroundColor3 = Color3.fromRGB(100, 250, 100)
LoginButton.Parent = LoginFrame

-- Fungsi Verifikasi Password
local function verifyPassword()
    if PasswordBox.Text == savedPassword then
        print("Login Berhasil!")
        LoginGUI:Destroy()
        loadSuperCapyUI()
    else
        print("Password Salah!")
    end
end

LoginButton.MouseButton1Click:Connect(verifyPassword)

-- Fungsi Memuat UI SuperCapy
function loadSuperCapyUI()
    local SuperCapyUI = Instance.new("ScreenGui")
    SuperCapyUI.Name = "SuperCapyUI"
    SuperCapyUI.Parent = playerGui

    local MainFrame = Instance.new("Frame")
    MainFrame.Size = UDim2.new(0, 300, 0, 250)
    MainFrame.Position = UDim2.new(0.5, -150, 0.5, -100)
    MainFrame.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
    MainFrame.Parent = SuperCapyUI

    local Title = Instance.new("TextLabel")
    Title.Size = UDim2.new(1, 0, 0, 30)
    Title.Text = "SuperCapy Hub"
    Title.TextSize = 20
    Title.TextColor3 = Color3.fromRGB(255, 255, 255)
    Title.BackgroundTransparency = 1
    Title.Parent = MainFrame

    -- Tombol Auto Farm
    local AutoFarmButton = Instance.new("TextButton")
    AutoFarmButton.Size = UDim2.new(0.8, 0, 0, 40)
    AutoFarmButton.Position = UDim2.new(0.1, 0, 0.2, 0)
    AutoFarmButton.BackgroundColor3 = Color3.fromRGB(50, 150, 250)
    AutoFarmButton.Text = "Auto Farm: OFF"
    AutoFarmButton.TextSize = 18
    AutoFarmButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    AutoFarmButton.Parent = MainFrame

    -- Tombol Auto Attack
    local AutoAttackButton = Instance.new("TextButton")
    AutoAttackButton.Size = UDim2.new(0.8, 0, 0, 40)
    AutoAttackButton.Position = UDim2.new(0.1, 0, 0.4, 0)
    AutoAttackButton.BackgroundColor3 = Color3.fromRGB(250, 100, 100)
    AutoAttackButton.Text = "Auto Attack: OFF"
    AutoAttackButton.TextSize = 18
    AutoAttackButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    AutoAttackButton.Parent = MainFrame

    -- Tombol Hop Server
    local HopServerButton = Instance.new("TextButton")
    HopServerButton.Size = UDim2.new(0.8, 0, 0, 40)
    HopServerButton.Position = UDim2.new(0.1, 0, 0.6, 0)
    HopServerButton.BackgroundColor3 = Color3.fromRGB(150, 100, 250)
    HopServerButton.Text = "Hop Server"
    HopServerButton.TextSize = 18
    HopServerButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    HopServerButton.Parent = MainFrame

    -- Fungsi Auto Farm
    local autoFarmActive = false
    AutoFarmButton.MouseButton1Click:Connect(function()
        autoFarmActive = not autoFarmActive
        if autoFarmActive then
            AutoFarmButton.Text = "Auto Farm: ON"
            AutoFarmButton.BackgroundColor3 = Color3.fromRGB(100, 250, 100)
            while autoFarmActive do
                local npc = getNearestNPC()
                if npc then
                    player.Character.HumanoidRootPart.CFrame = npc.HumanoidRootPart.CFrame + Vector3.new(0, 3, 0)
                end
                wait(0.5)
            end
        else
            AutoFarmButton.Text = "Auto Farm: OFF"
            AutoFarmButton.BackgroundColor3 = Color3.fromRGB(50, 150, 250)
        end
    end)

    -- Fungsi Auto Attack
    local autoAttackActive = false
    AutoAttackButton.MouseButton1Click:Connect(function()
        autoAttackActive = not autoAttackActive
        if autoAttackActive then
            AutoAttackButton.Text = "Auto Attack: ON"
            AutoAttackButton.BackgroundColor3 = Color3.fromRGB(100, 250, 100)
            while autoAttackActive do
                local npc = getNearestNPC()
                if npc then
                    game:GetService("ReplicatedStorage").Remotes.CommF_:InvokeServer("Hit", npc)
                end
                wait(0.2)
            end
        else
            AutoAttackButton.Text = "Auto Attack: OFF"
            AutoAttackButton.BackgroundColor3 = Color3.fromRGB(250, 100, 100)
        end
    end)

    -- Fungsi Hop Server
    HopServerButton.MouseButton1Click:Connect(function()
        local HttpService = game:GetService("HttpService")
        local Servers = HttpService:JSONDecode(game:HttpGet("https://games.roblox.com/v1/games/" .. game.PlaceId .. "/servers/Public?sortOrder=Asc&limit=100"))
        for _, server in pairs(Servers.data) do
            if server.id ~= game.JobId and server.playing < server.maxPlayers then
                game:GetService("TeleportService"):TeleportToPlaceInstance(game.PlaceId, server.id, player)
                break
            end
        end
    end)
end

-- Fungsi mencari musuh terdekat
function getNearestNPC()
    local nearestNPC = nil
    local shortestDistance = math.huge
    for _, npc in pairs(workspace.Enemies:GetChildren()) do
        if npc:FindFirstChild("HumanoidRootPart") and npc:FindFirstChild("Humanoid") and npc.Humanoid.Health > 0 then
            local distance = (npc.HumanoidRootPart.Position - player.Character.HumanoidRootPart.Position).magnitude
            if distance < shortestDistance then
                shortestDistance = distance
                nearestNPC = npc
            end
        end
    end
    return nearestNPC
end
